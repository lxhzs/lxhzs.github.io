<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="description"><meta name="keyword"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>原生js实现移动端Touch轮播图</title><link rel="shortcut icon" href="/images/avatar.jpg" type="image/x-icon"><link href="/styles/site.css" rel="stylesheet"><link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css?version=1.5.6"><body></body><header class="container" id="header"><div class="header"><div class="header-left"><div class="avatar"><img src="/images/avatar.jpg"></div><div class="author"><div class="author-name"><a href="/">Levi丶Blog</a></div><div class="about-me">大家好，我叫李新华。我的域名是“李新华真帅”。</div></div></div><div class="header-right"><ul class="navigation"><li><a href="/"><i class="fa fa-fw fa-home"> </i><br>首页</a></li><li><a href="/"><i class="fa fa-fw fa-book"> </i><br>博客</a></li><li><a href="/archives"><i class="fa fa-fw fa-archive"> </i><br>归档</a></li><li><a href="/categories"><i class="fa fa-fw fa-th"> </i><br>分类</a></li><li><a href="/tags"><i class="fa fa-fw fa-tags"> </i><br>标签</a></li><li><a href="/life"><i class="fa fa-fw fa-heart"> </i><br>生活</a></li><li><a href="/about"><i class="fa fa-fw fa-user"> </i><br>关于</a></li></ul></div><div class="about-me-mask"><div class="about-me-wrap"><div class="about-me__header"><div class="avatar"><img src="/images/avatar.jpg"></div></div><ul class="socials"><li class="social-item"><span class="label"><img src="/images/socials/github.svg" alt="https://github.com/gary-Shen"></span><a href="https://github.com/gary-Shen" target="_blank" title="https://github.com/gary-Shen">https://github.com/gary-Shen</a></li><li class="social-item"><span class="label"><img src="/images/socials/email.svg" alt="guanlinshen@126.com"></span><span>guanlinshen@126.com</span></li><li class="social-item"><span class="label"><img src="/images/socials/wechat.svg" alt="Grinson"></span><span>Grinson</span></li></ul></div></div></div></header><div class="container post"><section class="article"><div class="title">原生js实现移动端Touch轮播图</div><div class="date">写于2019年01月02日</div><div class="content"><p><img src="http://ww1.sinaimg.cn/large/007kscFEgy1fyshg854xcj31hc0u0tab.jpg" alt="image"></p>
<a id="more"></a>
<h2 id="touch-轮播图"><a class="header-anchor" href="#touch-轮播图"></a>Touch 轮播图</h2>
<blockquote>
<p><code>touch</code>轮播图其实就是通过手指的滑动，来左右切换轮播图，下面我们通过一个案例，来实现下。</p>
</blockquote>
<h3 id="1-html-结构"><a class="header-anchor" href="#1-html-结构"></a>1. html 结构</h3>
<blockquote>
<p>结构上，还是用<code>ul</code>、<code>li</code>来存放轮播图片，<code>ol</code>、<code>li</code>来存放轮播小圆点：</p>
</blockquote>
<p><img src="http://ww1.sinaimg.cn/large/007kscFEgy1fys7f1alh9j30vj0lxtb1.jpg" alt="image"></p>
<h3 id="2-样式初始化"><a class="header-anchor" href="#2-样式初始化"></a>2. 样式初始化</h3>
<blockquote>
<p><code>html</code>的一些标签，都会有一些默认样式，比如<code>body</code>标签默认是有一个边距的，为了不影响美观，我们需要清除掉。</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 清除标签默认边距 */</span></span><br><span class="line"><span class="selector-tag">body</span>,<span class="selector-tag">ul</span>,<span class="selector-tag">li</span>,<span class="selector-tag">ol</span>,<span class="selector-tag">img</span> &#123;</span><br><span class="line">	<span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">	<span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 清除 ul 等标签前面的“小圆点” */</span></span><br><span class="line"><span class="selector-tag">ul</span>,<span class="selector-tag">li</span>,<span class="selector-tag">ol</span> &#123;</span><br><span class="line">	<span class="attribute">list-style-type</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 图片自适应 */</span></span><br><span class="line"><span class="selector-tag">img</span> &#123;</span><br><span class="line">	<span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">	<span class="attribute">height</span>: auto;</span><br><span class="line">	<span class="attribute">border</span>: none;</span><br><span class="line">	<span class="comment">/* ie8 */</span></span><br><span class="line">	<span class="attribute">display</span>: block;</span><br><span class="line">	<span class="attribute">-ms-interpolation-mode</span>: bicubic; <span class="comment">/*为了照顾ie图片缩放失真*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://ww1.sinaimg.cn/large/007kscFEgy1fys7ijyn00j30uc0kvtk8.jpg" alt="image"></p>
<h3 id="3-添加样式"><a class="header-anchor" href="#3-添加样式"></a>3. 添加样式</h3>
<blockquote>
<p>在前面讲特效的时候，我们说过如何使用原生<code>js</code>实现移一个轮播图的概念，但是当时的方式是通过<code>li</code>浮动，这里给大家介绍一种新的方——定位。</p>
</blockquote>
<p><strong>思路：</strong></p>
<ul>
<li>给<code>ul</code>外层的盒子一个相对定位；</li>
<li>这里的<code>ul</code>高度不能写死，它应该是<code>li</code>撑开的高度，但是由于<code>li</code>绝对定位，没办法撑开这个高度，所以这里的<code>ul</code>需要在<code>js</code>里面动态设置高度；</li>
<li>给<code>li</code>设置相对定位，并且<code>left</code>、<code>top</code>都为<code>0</code>，再给<code>li</code>添加一个<code>transform:translateX(300%)</code>属性，目的是初始化显示的图片为空，然后在<code>js</code>里只需要动态设置每个<code>li</code>的<code>translateX</code>值，即可实现轮播；</li>
<li>设置小圆点区域，因为小圆点个数未知，所以<code>ol</code>的宽度也未知，想要让一个未知宽度的盒子水平居中，可以使用<code>absolute</code>定位结合<code>left</code>百分比的方式实现；</li>
<li>给<code>ol</code>下面的<code>li</code>设置一个宽高添加圆角边框属性，并且左浮动，这样就能显示一排空心的小圆点了；</li>
<li>最后，添加一个样式类，里面设置一个背景属性，用来显示当前展示图片对应的小圆点。</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 轮播图最外层盒子 */</span></span><br><span class="line"><span class="selector-class">.carousel</span> &#123;</span><br><span class="line">	<span class="attribute">position</span>: relative;</span><br><span class="line">	<span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.carousel</span> <span class="selector-tag">ul</span> &#123;</span><br><span class="line">	<span class="comment">/* 这个高度需要在JS里面动态添加 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.carousel</span> <span class="selector-tag">ul</span> <span class="selector-tag">li</span> &#123;</span><br><span class="line">	<span class="attribute">position</span>: absolute;</span><br><span class="line">	<span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">	<span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">	<span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">	<span class="comment">/* 使用 transform:translaX(300%) 暂时将 li 移动到屏幕外面去*/</span></span><br><span class="line">	<span class="attribute">-webkit-transform</span>: <span class="built_in">translateX</span>(300%);</span><br><span class="line">	<span class="attribute">transform</span>: <span class="built_in">translateX</span>(300%);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 小圆点盒子 */</span></span><br><span class="line"><span class="selector-class">.carousel</span> <span class="selector-class">.points</span> &#123;</span><br><span class="line">	<span class="comment">/* 未知宽度的盒子，使用 absolute 定位，结合 transform 的方式进行居中 */</span></span><br><span class="line">	<span class="attribute">position</span>: absolute;</span><br><span class="line">	<span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">	<span class="attribute">bottom</span>: <span class="number">10px</span>;</span><br><span class="line">	<span class="attribute">transform</span>: <span class="built_in">translateX</span>(-50%);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 小圆点 */</span></span><br><span class="line"><span class="selector-class">.carousel</span> <span class="selector-class">.points</span> <span class="selector-tag">li</span> &#123;</span><br><span class="line">	<span class="attribute">width</span>: <span class="number">5px</span>;</span><br><span class="line">	<span class="attribute">height</span>: <span class="number">5px</span>;</span><br><span class="line">	<span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">	<span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#fff</span>;</span><br><span class="line">	<span class="attribute">float</span>: left;</span><br><span class="line">	<span class="attribute">margin</span>: <span class="number">0</span> <span class="number">2px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 选中小圆点的样式类 */</span></span><br><span class="line"><span class="selector-class">.carousel</span> <span class="selector-class">.points</span> <span class="selector-tag">li</span><span class="selector-class">.active</span> &#123;</span><br><span class="line">	<span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://ww1.sinaimg.cn/large/007kscFEgy1fys8h3p39mj30bu0lhgm5.jpg" alt="image"></p>
<h3 id="4-js-准备工作"><a class="header-anchor" href="#4-js-准备工作"></a>4. js 准备工作</h3>
<blockquote>
<p>先不考虑别的，<code>js</code>在初始化的时候，首先要做的就是给<code>ul</code>添加上一个高度，不然图片是不显示的。</p>
</blockquote>
<ul>
<li>给<code>UL</code>动态设置高度</li>
<li>动态生成小圆点 （根据图片的张数创建小圆点个数，<code>i=0</code> 添加<code>active</code>）</li>
<li>初始化三个<code>li</code>的基本位置
<ul>
<li>定义三个变量，分别用来存储三个<code>li</code>的下（<code>left</code>存储最后一张图片的下标，<code>center</code>和<code>right</code>分别存储第一张和第二张的下标）</li>
<li>通过<code>数组[下标]</code>的方式给三个<code>li</code>设置定位后<code>left</code>方向的位置</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> carousel = <span class="built_in">document</span>.querySelector(<span class="string">'.carousel'</span>);</span><br><span class="line"><span class="keyword">var</span> carouselUl = carousel.querySelector(<span class="string">'ul'</span>);</span><br><span class="line"><span class="keyword">var</span> carouselLis = carouselUl.querySelectorAll(<span class="string">'li'</span>);</span><br><span class="line"><span class="keyword">var</span> points = carousel.querySelector(<span class="string">'ol'</span>);</span><br><span class="line"><span class="comment">// 屏幕的宽度（轮播图显示区域的宽度）</span></span><br><span class="line"><span class="keyword">var</span> screenWidth = <span class="built_in">document</span>.documentElement.offsetWidth;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1- ul设置高度</span></span><br><span class="line">carouselUl.style.height = carouselLis[<span class="number">0</span>].offsetHeight + <span class="string">'px'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2- 生成小圆点</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; carouselLis.length; i++)&#123;</span><br><span class="line">	<span class="keyword">var</span> li = <span class="built_in">document</span>.createElement(<span class="string">'li'</span>);</span><br><span class="line">	<span class="keyword">if</span>(i == <span class="number">0</span>)&#123;</span><br><span class="line">		li.classList.add(<span class="string">'active'</span>);</span><br><span class="line">	&#125;<span class="comment">//</span></span><br><span class="line">	points.appendChild(li);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3- 初始三个 li 固定的位置</span></span><br><span class="line"><span class="keyword">var</span> left = carouselLis.length - <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> center = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> right = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 归位</span></span><br><span class="line">carouselLis[left].style.transform = <span class="string">'translateX('</span>+ (-screenWidth) +<span class="string">'px)'</span>;</span><br><span class="line">carouselLis[center].style.transform = <span class="string">'translateX(0px)'</span>;</span><br><span class="line">carouselLis[right].style.transform = <span class="string">'translateX('</span>+ screenWidth +<span class="string">'px)'</span>;</span><br></pre></td></tr></table></figure>
<p><img src="http://ww1.sinaimg.cn/large/007kscFEgy1fys9wa2l8oj30wl0krn48.jpg" alt="image"></p>
<p><strong>效果图：</strong></p>
<p><img src="http://ww1.sinaimg.cn/large/007kscFEgy1fysabzcch5j309w0ipac1.jpg" alt="image"></p>
<h3 id="5-添加定时器-让图片动起来"><a class="header-anchor" href="#5-添加定时器-让图片动起来"></a>5. 添加定时器，让图片动起来</h3>
<blockquote>
<p>轮播图都会自己轮播，所以需要用到定时器，每隔一段时间执行一次轮转函数。</p>
</blockquote>
<ul>
<li>添加定时器，定时器里面轮转下标</li>
<li>极值判断</li>
<li>设置过渡（替补的那张不需要过渡）</li>
<li>归位</li>
<li>小圆点焦点联动</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> timer = <span class="literal">null</span>;</span><br><span class="line"><span class="comment">// 调用定时器</span></span><br><span class="line">timer = setInterval(showNext, <span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 轮播图片切换</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showNext</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="comment">// 轮转下标</span></span><br><span class="line">	left = center;</span><br><span class="line">	center = right;</span><br><span class="line">	right++;</span><br><span class="line">    <span class="comment">// 极值判断</span></span><br><span class="line">	<span class="keyword">if</span>(right &gt; carouselLis.length - <span class="number">1</span>)&#123;</span><br><span class="line">		right = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//添加过渡</span></span><br><span class="line">	carouselLis[left].style.transition = <span class="string">'transform 1s'</span>;</span><br><span class="line">	carouselLis[center].style.transition = <span class="string">'transform 1s'</span>;</span><br><span class="line">	<span class="comment">// 右边的图片永远是替补的，不能添加过渡</span></span><br><span class="line">	carouselLis[right].style.transition = <span class="string">'none'</span>;</span><br><span class="line">	<span class="comment">// 归位</span></span><br><span class="line">	carouselLis[left].style.transform = <span class="string">'translateX('</span>+ (-screenWidth) +<span class="string">'px)'</span>;</span><br><span class="line">	carouselLis[center].style.transform = <span class="string">'translateX(0px)'</span>;</span><br><span class="line">	carouselLis[right].style.transform = <span class="string">'translateX('</span>+ screenWidth +<span class="string">'px)'</span>;</span><br><span class="line">	<span class="comment">// 自动设置小圆点</span></span><br><span class="line">	setPoint();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 动态设置小圆点的active类</span></span><br><span class="line"><span class="keyword">var</span> pointsLis = points.querySelectorAll(<span class="string">'li'</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setPoint</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; pointsLis.length; i++)&#123;</span><br><span class="line">		pointsLis[i].classList.remove(<span class="string">'active'</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	pointsLis[center].classList.add(<span class="string">'active'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://ww1.sinaimg.cn/large/007kscFEgy1fysb8uekrqj311b0nftgb.jpg" alt="image"></p>
<p><strong>效果图：</strong></p>
<p><img src="http://ww1.sinaimg.cn/large/007kscFEgy1fysbd2wu5tg30a30iqapb.gif" alt="image"></p>
<h3 id="6-touch-滑动"><a class="header-anchor" href="#6-touch-滑动"></a>6. touch 滑动</h3>
<blockquote>
<p>移动端的轮播图，配合<code>touch</code>滑动事件，效果更加友好。</p>
</blockquote>
<ul>
<li>分别绑定三个<code>touch</code>事件
<ul>
<li><code>touchstart</code>里面记录手指的位置，清除定时器，记录时间</li>
<li><code>touchmove</code>里面获取差值，同时清除过渡，累加上差值的值</li>
<li><code>touchend</code>里面判断是否滑动成功，滑动的依据是滑动的距离（绝对值）</li>
</ul>
</li>
<li>超过屏幕的三分之一或者滑动的时间小于<code>300</code>毫秒同时距离大于<code>30</code>（防止点击就跑）的时候都认为是滑动成功</li>
<li>在滑动成功的条件分支里面在判断滑动的方向，根据方向选择调用上一张还是下一张的逻辑</li>
<li>在滑动失败的条件分支里面添加上过渡，重新进行归位</li>
<li>重启定时器</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> carousel = <span class="built_in">document</span>.querySelector(<span class="string">'.carousel'</span>);</span><br><span class="line"><span class="keyword">var</span> carouselUl = carousel.querySelector(<span class="string">'ul'</span>);</span><br><span class="line"><span class="keyword">var</span> carouselLis = carouselUl.querySelectorAll(<span class="string">'li'</span>);</span><br><span class="line"><span class="keyword">var</span> points = carousel.querySelector(<span class="string">'ol'</span>);</span><br><span class="line"><span class="comment">// 屏幕的宽度</span></span><br><span class="line"><span class="keyword">var</span> screenWidth = <span class="built_in">document</span>.documentElement.offsetWidth;</span><br><span class="line"><span class="keyword">var</span> timer = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置 ul 的高度</span></span><br><span class="line">carouselUl.style.height = carouselLis[<span class="number">0</span>].offsetHeight + <span class="string">'px'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 动态生成小圆点</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; carouselLis.length; i++) &#123;</span><br><span class="line">	<span class="keyword">var</span> li = <span class="built_in">document</span>.createElement(<span class="string">'li'</span>);</span><br><span class="line">	<span class="keyword">if</span> (i == <span class="number">0</span>) &#123;</span><br><span class="line">		li.classList.add(<span class="string">'active'</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	points.appendChild(li);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始三个固定的位置</span></span><br><span class="line"><span class="keyword">var</span> left = carouselLis.length - <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> center = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> right = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 归位（多次使用，封装成函数）</span></span><br><span class="line">setTransform();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用定时器</span></span><br><span class="line">timer = setInterval(showNext, <span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 分别绑定touch事件</span></span><br><span class="line"><span class="keyword">var</span> startX = <span class="number">0</span>;  <span class="comment">// 手指落点</span></span><br><span class="line"><span class="keyword">var</span> startTime = <span class="literal">null</span>; <span class="comment">// 开始触摸时间</span></span><br><span class="line">carouselUl.addEventListener(<span class="string">'touchstart'</span>, touchstartHandler); <span class="comment">// 滑动开始绑定的函数 touchstartHandler</span></span><br><span class="line">carouselUl.addEventListener(<span class="string">'touchmove'</span>, touchmoveHandler);   <span class="comment">// 持续滑动绑定的函数 touchmoveHandler</span></span><br><span class="line">carouselUl.addEventListener(<span class="string">'touchend'</span>, touchendHandeler);    <span class="comment">// 滑动结束绑定的函数 touchendHandeler</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 轮播图片切换下一张</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showNext</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="comment">// 轮转下标</span></span><br><span class="line">	left = center;</span><br><span class="line">	center = right;</span><br><span class="line">	right++;</span><br><span class="line">	<span class="comment">//　极值判断</span></span><br><span class="line">	<span class="keyword">if</span> (right &gt; carouselLis.length - <span class="number">1</span>) &#123;</span><br><span class="line">		right = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//添加过渡（多次使用，封装成函数）</span></span><br><span class="line">	setTransition(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="comment">// 归位</span></span><br><span class="line">	setTransform();</span><br><span class="line">	<span class="comment">// 自动设置小圆点</span></span><br><span class="line">	setPoint();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 轮播图片切换上一张</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showPrev</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="comment">// 轮转下标</span></span><br><span class="line">	right = center;</span><br><span class="line">	center = left;</span><br><span class="line">	left--;</span><br><span class="line">	<span class="comment">//　极值判断</span></span><br><span class="line">	<span class="keyword">if</span> (left &lt; <span class="number">0</span>) &#123;</span><br><span class="line">		left = carouselLis.length - <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//添加过渡</span></span><br><span class="line">	setTransition(<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">	<span class="comment">// 归位</span></span><br><span class="line">	setTransform();</span><br><span class="line">	<span class="comment">// 自动设置小圆点</span></span><br><span class="line">	setPoint();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 滑动开始</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">touchstartHandler</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">	<span class="comment">// 清除定时器</span></span><br><span class="line">	clearInterval(timer);</span><br><span class="line">	<span class="comment">// 记录滑动开始的时间</span></span><br><span class="line">	startTime = <span class="built_in">Date</span>.now();</span><br><span class="line">	<span class="comment">// 记录手指最开始的落点</span></span><br><span class="line">	startX = e.changedTouches[<span class="number">0</span>].clientX;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 滑动持续中</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">touchmoveHandler</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">	<span class="comment">// 获取差值 自带正负</span></span><br><span class="line">	<span class="keyword">var</span> dx = e.changedTouches[<span class="number">0</span>].clientX - startX;</span><br><span class="line">	<span class="comment">// 干掉过渡</span></span><br><span class="line">	setTransition(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="comment">// 归位</span></span><br><span class="line">	setTransform(dx);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//　滑动结束</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">touchendHandeler</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">	<span class="comment">// 在手指松开的时候，要判断当前是否滑动成功</span></span><br><span class="line">	<span class="keyword">var</span> dx = e.changedTouches[<span class="number">0</span>].clientX - startX;</span><br><span class="line">	<span class="comment">// 获取时间差</span></span><br><span class="line">	<span class="keyword">var</span> dTime = <span class="built_in">Date</span>.now() - startTime;</span><br><span class="line">	<span class="comment">// 滑动成功的依据是滑动的距离（绝对值）超过屏幕的三分之一 或者滑动的时间小于300毫秒同时滑动的距离大于30</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">Math</span>.abs(dx) &gt; screenWidth / <span class="number">3</span> || (dTime &lt; <span class="number">300</span> &amp;&amp; <span class="built_in">Math</span>.abs(dx) &gt; <span class="number">30</span>)) &#123;</span><br><span class="line">		<span class="comment">// 滑动成功了</span></span><br><span class="line">		<span class="comment">// 判断用户是往哪个方向滑</span></span><br><span class="line">		<span class="keyword">if</span> (dx &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="comment">// 往右滑 看到上一张</span></span><br><span class="line">			showPrev();</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">// 往左滑 看到下一张</span></span><br><span class="line">			showNext();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">// 添加上过渡</span></span><br><span class="line">		setTransition(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">		<span class="comment">// 滑动失败了</span></span><br><span class="line">		setTransform();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 重新启动定时器</span></span><br><span class="line">	clearInterval(timer);</span><br><span class="line">	<span class="comment">// 调用定时器</span></span><br><span class="line">	timer = setInterval(showNext, <span class="number">2000</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 设置过渡</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setTransition</span>(<span class="params">a, b, c</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (a) &#123;</span><br><span class="line">		carouselLis[left].style.transition = <span class="string">'transform 1s'</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		carouselLis[left].style.transition = <span class="string">'none'</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (b) &#123;</span><br><span class="line">		carouselLis[center].style.transition = <span class="string">'transform 1s'</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		carouselLis[center].style.transition = <span class="string">'none'</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (c) &#123;</span><br><span class="line">		carouselLis[right].style.transition = <span class="string">'transform 1s'</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		carouselLis[right].style.transition = <span class="string">'none'</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//　封装归位</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setTransform</span>(<span class="params">dx</span>) </span>&#123;</span><br><span class="line">	dx = dx || <span class="number">0</span>;</span><br><span class="line">	carouselLis[left].style.transform = <span class="string">'translateX('</span> + (-screenWidth + dx) + <span class="string">'px)'</span>;</span><br><span class="line">	carouselLis[center].style.transform = <span class="string">'translateX('</span> + dx + <span class="string">'px)'</span>;</span><br><span class="line">	carouselLis[right].style.transform = <span class="string">'translateX('</span> + (screenWidth + dx) + <span class="string">'px)'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 动态设置小圆点的active类</span></span><br><span class="line"><span class="keyword">var</span> pointsLis = points.querySelectorAll(<span class="string">'li'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setPoint</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; pointsLis.length; i++) &#123;</span><br><span class="line">		pointsLis[i].classList.remove(<span class="string">'active'</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	pointsLis[center].classList.add(<span class="string">'active'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://ww1.sinaimg.cn/large/007kscFEgy1fysgm1exetj311o0nzdno.jpg" alt="image"></p>
<p><strong>效果图：</strong></p>
<p><img src="http://ww1.sinaimg.cn/large/007kscFEgy1fyscumcfdbg30a30iq1bc.gif" alt="image"></p>
</div><div class="toc-article" id="toc"><div class="toc-title"></div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#touch-轮播图"><span class="toc-text">Touch 轮播图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-html-结构"><span class="toc-text">1. html 结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-样式初始化"><span class="toc-text">2. 样式初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-添加样式"><span class="toc-text">3. 添加样式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-js-准备工作"><span class="toc-text">4. js 准备工作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-添加定时器-让图片动起来"><span class="toc-text">5. 添加定时器，让图片动起来</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-touch-滑动"><span class="toc-text">6. touch 滑动</span></a></li></ol></li></ol></div><p class="ending">本篇完</p><div class="tags"><a class="tag-link" href="/tags/touch轮播图/">touch轮播图</a></div></section></div><div id="articleMenu"><i class="fa fa-list iconColor"></i></div><div class="container"><ul class="nav"><li>下一篇：<a href="/2018/12/27/JS-进阶知识-高级篇/">JS 进阶知识-高级篇</a></li></ul></div><div id="backToTop"><div class="back-arrow back-arrow-left"></div><div class="back-arrow back-arrow-right"></div></div><footer class="container"><div class="rights"><span>© 2018 </span><i class="fa fa-heartbeat iconColor"> </i><span>Levi丶</span></div></footer><canvas id="canvas"></canvas><script src="/script/jquery.min.js"></script><link rel="stylesheet" href="/fancybox/jquery.fancybox.css"><script src="/fancybox/jquery.fancybox.pack.js"></script><script src="/script/index.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-61220413-1', 'auto');
ga('send', 'pageview');</script><script src="/script/post.js"></script></head></html>